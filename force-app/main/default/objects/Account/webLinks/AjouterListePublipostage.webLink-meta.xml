<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>AjouterListePublipostage</fullName>
    <availability>online</availability>
    <displayType>massActionButton</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Ajouter Ã  la liste de publipostage</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <requireRowSelection>true</requireRowSelection>
    <url>var objectAPIName = &quot;Account&quot;; 
var oRecords = {!GETRECORDIDS($ObjectType.Account)}; 
{!REQUIRESCRIPT(&quot;/soap/ajax/36.0/connection.js&quot;)} 

var url = parent.location.href; //string for the URL of the current page 
var jRecords = []; 

if (oRecords[0] == null) { //no record selected 
alert(&quot;Please select at least one record.&quot;); 
} 
else 
{ 
var csvIds = &quot;&quot;; 
for(var i in oRecords){ 
csvIds += &quot;&#39;&quot;+ oRecords[i] + &quot;&#39;,&quot;; 
} 
csvIds = csvIds.slice(0, csvIds.length - 1); 
if(csvIds.length &gt; 1){ 
csvIds = &quot;(&quot; + csvIds + &quot;)&quot;; 
} 

var oResult = sforce.connection.query(&quot;select Name, Id from &quot;+objectAPIName+&quot; Where Id IN &quot; +csvIds); 
var records = oResult.getArray(&quot;records&quot;); 
for (var i=0; i&lt; records.length; i++) 
{ 
var sdjob = new sforce.SObject(&quot;SDoc__SDJob__c&quot;); 
sdjob.SDoc__oId__c = records[i].Id; 
sdjob.SDoc__objSortVal__c = records[i].Name; 
sdjob.SDoc__runas__c = &quot;{!$User.Username}&quot;; 
sdjob.SDoc__Status__c = &quot;Selected&quot;; 
sdjob.SDoc__type__c = &quot;Bulk Job - List View&quot;; 
sdjob.SDoc__objAPIName__c = objectAPIName; 
jRecords.push(sdjob); 
} 
var result = sforce.connection.create(jRecords); 
} 


var errors = []; 
if (result &amp;&amp; result.length){ 
var numFailed = 0; 
var numSucceeded = 0; 
for (var i = 0; i &lt; result.length; i++){ 
var res = result[i]; 
if (res &amp;&amp; res.success == &#39;true&#39;){ 
numSucceeded++; 
} else { 
var es = res.getArray(&quot;errors&quot;); 
if (es.length &gt; 0) { 
errors.push(es[0].message); 
} 
numFailed++; 
} 
} 
if (numFailed &gt; 0){ 
alert(&quot;Failed: &quot; + numFailed + &quot;\nSucceeded: &quot; + numSucceeded + &quot; \n Due to: &quot; + errors.join(&quot;\n&quot;)); 
} else { 
var sdresult = sforce.connection.query(&quot;SELECT count(Id) jCount FROM SDoc__SDJOB__c WHERE ownerid = &#39;{!$User.Id}&#39;&quot;); 
alert(numSucceeded + &quot; Records Successfully Added.\n&quot; +sdresult.records.jCount+&quot; Total Records are now in your Mass Merge List.&quot;); 
} 
} 
//window.location.reload();</url>
</WebLink>
